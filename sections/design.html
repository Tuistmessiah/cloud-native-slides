<section>
    <h2>üîπ Exercise: Design Kafka Architecture</h2>
    <p>Hands-on: Work on designing a Kafka pipeline.</p>
    <p class="right">Demo: Kafka CLI ‚û°Ô∏è</p>
</section>

<section>
    <h2>üõ†Ô∏è Exercise 1: Kafka-based IoT Data Pipeline</h2>
    <p><strong>Objective:</strong> Design a real-time data pipeline for a smart city using Kafka.</p>
    <ol>
        <li>Identify IoT devices and data streams.</li>
        <li>Define Kafka topics for each data stream.</li>
        <li>Plan data ingestion and processing layers.</li>
        <li>Design the Kafka cluster</li>
        <li>Design the data processing and analysis layer</li>
        <li>Design storage.</li>
        <li>Design visualization an alerting dashboard</li>
        <li>Sketch the architecture.</li>
    </ol>
    <p class="down">‚¨áÔ∏è Solution: step 1</p>
</section>

<section>
    <h2>üìã Step 1: IoT Devices & Data Streams</h2>
    <table>
        <tr>
            <th>IoT Device</th>
            <th>Data Stream</th>
            <th>Example Format</th>
        </tr>
        <tr>
            <td>Traffic Sensors</td>
            <td>Vehicle count, speed</td>
            <td>{"sensor_id":1, "speed":45, "count":10}</td>
        </tr>
        <tr>
            <td>Weather Stations</td>
            <td>Temperature, humidity</td>
            <td>{"station_id":5, "temperature":25.3}</td>
        </tr>
        <tr>
            <td>Energy Meters</td>
            <td>Power consumption</td>
            <td>{"meter_id":1001, "usage":3.5}</td>
        </tr>
        <tr>
            <td>Air Quality Monitors</td>
            <td>CO2 levels, AQI</td>
            <td>{"monitor_id":3, "aqi":90}</td>
        </tr>
    </table>
    <p class="down">‚¨áÔ∏è Solution: step 2</p>
</section>

<section>
    <h2>üì¶ Step 2: Kafka Topics</h2>
    <ul>
        <li><strong>traffic-data:</strong> Real-time traffic data</li>
        <li><strong>weather-data:</strong> Environmental readings</li>
        <li><strong>energy-usage:</strong> Household power data</li>
        <li><strong>air-quality:</strong> Air pollution levels</li>
    </ul>
    <p class="down">‚¨áÔ∏è Solution: step 3</p>
</section>

<section>
    <h2>üîÑ Step 3: Data Ingestion Layer</h2>
    <p>IoT devices send data to Kafka:</p>
    <ul>
        <li><strong>Producers:</strong> Each device acts as a Kafka producer.</li>
        <li><strong>Protocol:</strong> MQTT or HTTP Kafka REST Proxy.</li>
        <li><strong>Format:</strong> JSON or Avro for structured messages.</li>
    </ul>
    <pre><code class="language-js">
const message = JSON.stringify({
  sensor_id: 1,
  location: "A1",
  speed: Math.random() * 80,
  count: Math.random() * 20
});
producer.send([{ topic: "traffic-data", messages: message }]);
    </code></pre>
    <p class="down">‚¨áÔ∏è Solution: step 4</p>
</section>

<section>
    <h2>‚öôÔ∏è Step 4: Kafka Cluster</h2>
    <p>Configure Kafka Cluster:</p>
    <ul>
        <li><strong>Brokers:</strong> 3 for fault tolerance</li>
        <li><strong>Partitions:</strong> Multiple partitions for parallel processing</li>
        <li><strong>Replication:</strong> Factor of 3 for high availability</li>
    </ul>
    <pre><code class="language-yaml">
        version: '3'
        services:
          zookeeper:
            image: wurstmeister/zookeeper
            ports:
              - "2181:2181"
        
          kafka:
            image: wurstmeister/kafka
            ports:
              - "9092:9092"
            environment:
              KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092
              KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
    </code></pre>
    <p class="down">‚¨áÔ∏è Solution: step 5</p>
</section>

<section>
    <h2>üîç Step 5: Data Processing & Analysis</h2>
    <p>Use Kafka Streams for real-time analysis:</p>
    <pre><code class="language-js">
trafficStream
  .mapJSONParse()
  .groupByKey()
  .countByKey("traffic-store", 5 * 60 * 1000)
  .to("traffic-aggregated");
    </code></pre>
    <p class="down">‚¨áÔ∏è Solution: step 6</p>
</section>

<section>
    <h2>üíæ Step 6: Data Storage Layer</h2>
    <p>Store processed data:</p>
    <ul>
        <li><strong>PostgreSQL:</strong> Structured data</li>
        <li><strong>Elasticsearch:</strong> Real-time search</li>
        <li><strong>S3:</strong> Big data storage</li>
    </ul>
    <pre><code class="language-js">
client.query("INSERT INTO traffic_data (sensor_id, speed, count)
VALUES ($1, $2, $3)", [data.sensor_id, data.speed, data.count]);
    </code></pre>
    <p class="down">‚¨áÔ∏è Solution: step 7</p>
</section>

<section>
    <h2>üìä Step 7: Visualization & Alerting</h2>
    <ul>
        <li><strong>Dashboard:</strong> Grafana or Kibana</li>
        <li><strong>Alerts:</strong> Anomalies trigger notifications</li>
    </ul>
    <pre><code class="language-js">
if (event.count > 50) {
  console.log(`üö® High Traffic Alert: ${event.location}`);
}
    </code></pre>
    <p class="down">‚¨áÔ∏è Solution: step 8</p>
</section>

<section>
    <h2>üìù Step 8: Architecture Diagram</h2>

    <svg viewBox="0 0 800 400" width="100%" height="auto" xmlns="http://www.w3.org/2000/svg" style="font-family: sans-serif; font-size: 14px">
        <!-- IOT Devices -->
        <rect x="10" y="150" width="120" height="40" fill="#ffffff" stroke="#000" />
        <text x="30" y="175">IoT Devices</text>

        <!-- Producer -->
        <rect x="150" y="150" width="100" height="40" fill="#fff0f6" stroke="#000" />
        <text x="165" y="175">Kafka Producer</text>

        <!-- Kafka Brokers -->
        <rect x="280" y="60" width="100" height="40" fill="#fffbe6" stroke="#000" />
        <text x="295" y="85">Kafka Broker</text>

        <rect x="280" y="120" width="100" height="40" fill="#fffbe6" stroke="#000" />
        <text x="295" y="145">Kafka Broker</text>

        <rect x="280" y="180" width="100" height="40" fill="#fffbe6" stroke="#000" />
        <text x="295" y="205">Kafka Broker</text>

        <!-- Consumer -->
        <rect x="410" y="60" width="100" height="40" fill="#f9f0ff" stroke="#000" />
        <text x="430" y="85">Consumer</text>

        <!-- Stream Processor -->
        <rect x="410" y="180" width="130" height="40" fill="#e6fffb" stroke="#000" />
        <text x="420" y="205">Stream Processor</text>

        <!-- Storage -->
        <rect x="570" y="40" width="100" height="40" fill="#f6ffed" stroke="#000" />
        <text x="595" y="65">Database</text>

        <rect x="570" y="100" width="100" height="40" fill="#f6ffed" stroke="#000" />
        <text x="595" y="125">Data Lake</text>

        <!-- Dashboard -->
        <rect x="570" y="180" width="100" height="40" fill="#e6f7ff" stroke="#000" />
        <text x="595" y="205">Dashboard</text>

        <!-- Arrows (white) -->
        <line x1="130" y1="170" x2="150" y2="170" stroke="#fff" stroke-width="2" marker-end="url(#arrow)" />
        <line x1="250" y1="170" x2="280" y2="170" stroke="#fff" stroke-width="2" marker-end="url(#arrow)" />
        <line x1="380" y1="80" x2="410" y2="80" stroke="#fff" stroke-width="2" marker-end="url(#arrow)" />
        <line x1="380" y1="200" x2="410" y2="200" stroke="#fff" stroke-width="2" marker-end="url(#arrow)" />

        <!-- From Consumer to DB/Data Lake -->
        <line x1="510" y1="80" x2="570" y2="60" stroke="#fff" stroke-width="2" marker-end="url(#arrow)" />
        <line x1="510" y1="80" x2="570" y2="120" stroke="#fff" stroke-width="2" marker-end="url(#arrow)" />

        <!-- From Stream Processor to Dashboard -->
        <line x1="540" y1="200" x2="570" y2="200" stroke="#fff" stroke-width="2" marker-end="url(#arrow)" />

        <!-- Arrow marker -->
        <defs>
            <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
                <path d="M0,0 L0,6 L9,3 z" fill="#fff" />
            </marker>
        </defs>
    </svg>

    <p class="down">Summary ‚û°Ô∏è</p>
</section>
